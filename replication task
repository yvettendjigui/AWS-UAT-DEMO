resource "aws_dms_replication_task" "uat_migration" {
  replication_task_id       = "UAT_DMS_MIGRATION"
  migration_type            = "full-load"
  replication_instance_arn  = aws_dms_replication_instance.this.replication_instance_arn
  source_endpoint_arn       = aws_dms_endpoint.source.endpoint_arn
  target_endpoint_arn       = aws_dms_endpoint.target.endpoint_arn

  # Table mappings JSON
  table_mappings = <<EOT
{
  "rules": [
    {
      "rule-type": "selection",
      "rule-id": "1",
      "rule-name": "include-all",
      "object-locator": {
        "schema-name": "%",
        "table-name": "%"
      },
      "rule-action": "include"
    }
  ]
}
EOT

  # Optional: fine-tune task settings JSON
  replication_task_settings = <<EOT
{
  "TargetMetadata": {
    "ParallelApplyThreads": 8,
    "ParallelApplyBufferSize": 1000
  },
  "FullLoadSettings": {
    "TargetTablePrepMode": "DO_NOTHING",
    "StopTaskCachedChangesApplied": false,
    "StopTaskCachedChangesNotApplied": false
  }
}
EOT
}
